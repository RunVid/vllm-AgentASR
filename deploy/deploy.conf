#!/bin/bash

# --- Shared Deployment Configuration ---

# VERSION: Used for Python package version (must be PEP 440 compliant)
# Keep this fixed for builds
VERSION="0.0.0.dev"

# IMAGE_TAG: Used for Docker image tag (can use git hash)
# Default: git short hash, so each commit gets a unique image tag
# Override: IMAGE_TAG=v1.0.0 ./deploy/docker-build.sh
IMAGE_TAG="${IMAGE_TAG:-$(git rev-parse --short HEAD 2>/dev/null || echo 'latest')}"

# Define the specific GPUs to use for deployment
GPUS_TO_USE_STAGING=(0)
GPUS_TO_USE_PROD=(1 2 3 4 5 6 7)

# Define how many container instances to run on EACH GPU
INSTANCES_PER_GPU_STAGING=1
INSTANCES_PER_GPU_PROD=2

# Define the starting port for host-to-container port mapping
BASE_PORT_STAGING=51001
BASE_PORT_PROD=50105

# Define the name of the Docker image to be used
IMAGE_NAME="19pine/vllm-agent-asr"

# Define the specific model directory name to use for this deployment.
# This can be a HuggingFace model ID (e.g., "19pine/agentasr") or a local path.
MODEL_PATH="19pine/agentasr-v2.3-12400"

# HuggingFace Token for accessing private models (optional for public models)
# IMPORTANT: DO NOT hardcode the token here! Use environment variable instead:
#   - For manual deployment: export HF_TOKEN=your_token
#   - For CI/CD: Set HF_TOKEN in GitHub Secrets
HF_TOKEN="${HF_TOKEN:-}"

# HuggingFace cache directory on the host machine
# This directory will be mounted into the containers to avoid repeated downloads
HF_CACHE_DIR="${HOME}/.cache/huggingface"

# Define the filename of the audio file to be used by the warmup script.
# This file should be located in the same directory as the scripts (deploy/).
WARMUP_AUDIO_FILENAME="number.wav"

# --- End Configuration ---
